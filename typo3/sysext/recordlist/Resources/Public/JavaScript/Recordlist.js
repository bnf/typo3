/*
 * This file is part of the TYPO3 CMS project.
 *
 * It is free software; you can redistribute it and/or modify it under
 * the terms of the GNU General Public License, either version 2
 * of the License, or any later version.
 *
 * For the full copyright and license information, please read the
 * LICENSE.txt file that was distributed with this source code.
 *
 * The TYPO3 project - inspiring people to share!
 */
<<<<<<< HEAD
var __importDefault=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};define(["require","exports","jquery","TYPO3/CMS/Backend/Icons","TYPO3/CMS/Backend/Storage/Persistent","TYPO3/CMS/Core/Event/RegularEvent","TYPO3/CMS/Backend/Tooltip","TYPO3/CMS/Core/DocumentService","TYPO3/CMS/Backend/Modal","TYPO3/CMS/Backend/Enum/Severity","TYPO3/CMS/Backend/Severity"],(function(t,e,i,a,n,l,o,d,r,s,c){"use strict";i=__importDefault(i);class u{constructor(){this.identifier={entity:".t3js-entity",toggle:".t3js-toggle-recordlist",localize:".t3js-action-localize",searchboxToolbar:"#db_list-searchbox-toolbar",searchboxToggle:".t3js-toggle-search-toolbox",searchField:"#search_field",icons:{collapse:"actions-view-list-collapse",expand:"actions-view-list-expand",editMultiple:".t3js-record-edit-multiple"}},this.toggleClick=t=>{t.preventDefault();const e=i.default(t.currentTarget),l=e.data("table"),o=i.default(e.data("bs-target")),d="expanded"===o.data("state"),r=e.find(".collapseIcon"),s=d?this.identifier.icons.expand:this.identifier.icons.collapse;a.getIcon(s,a.sizes.small).done(t=>{r.html(t)});let c={};n.isset("moduleData.list")&&(c=n.get("moduleData.list"));const u={};u[l]=d?1:0,i.default.extend(c,u),n.set("moduleData.list",c).done(()=>{o.data("state",d?"collapsed":"expanded")})},this.onEditMultiple=t=>{t.preventDefault();let e="",i="",a="",n=[];if("multiRecordSelection:action:edit"===t.type){const a=t.detail,l=a.configuration;if(i=l.returnUrl||"",e=l.tableName||"",""===e)return;a.checkboxes.forEach(t=>{const e=t.closest("tr");null!==e&&e.dataset[l.idField]&&n.push(e.dataset[l.idField])})}else{const l=t.currentTarget,o=l.closest("[data-table]");if(null===o)return;if(e=o.dataset.table||"",""===e)return;i=l.dataset.returnUrl||"",a=l.dataset.columnsOnly||"";const d=o.querySelectorAll(this.identifier.entity+'[data-uid][data-table="'+e+'"] td.col-selector input[type="checkbox"]:checked');if(d.length)d.forEach(t=>{n.push(t.closest(this.identifier.entity+'[data-uid][data-table="'+e+'"]').dataset.uid)});else{const t=o.querySelectorAll(this.identifier.entity+'[data-uid][data-table="'+e+'"]');if(!t.length)return;t.forEach(t=>{n.push(t.dataset.uid)})}}if(!n.length)return;let l=top.TYPO3.settings.FormEngine.moduleUrl+"&edit["+e+"]["+n.join(",")+"]=edit&returnUrl="+u.getReturnUrl(i);""!==a&&(l+="&columnsOnly="+a),window.location.href=l},this.disableButton=t=>{i.default(t.currentTarget).prop("disable",!0).addClass("disabled")},this.toggleSearchbox=()=>{const t=i.default(this.identifier.searchboxToolbar);t.toggle(),t.is(":visible")&&i.default(this.identifier.searchField).focus()},this.deleteRow=t=>{const e=i.default(`table[data-table="${t.table}"]`),a=e.find(`tr[data-uid="${t.uid}"]`),n=e.closest(".panel"),l=n.find(".panel-heading"),o=e.find(`[data-l10nparent="${t.uid}"]`),d=i.default().add(a).add(o);if(d.fadeTo("slow",.4,()=>{d.slideUp("slow",()=>{d.remove(),0===e.find("tbody tr").length&&n.slideUp("slow")})}),"0"===a.data("l10nparent")||""===a.data("l10nparent")){const t=Number(l.find(".t3js-table-total-items").html());l.find(".t3js-table-total-items").text(t-1)}"pages"===t.table&&top.document.dispatchEvent(new CustomEvent("typo3:pagetree:refresh"))},this.registerPaginationEvents=()=>{document.querySelectorAll(".t3js-recordlist-paging").forEach(t=>{t.addEventListener("keyup",e=>{e.preventDefault();let i=parseInt(t.value,10);i<parseInt(t.min,10)&&(i=parseInt(t.min,10)),i>parseInt(t.max,10)&&(i=parseInt(t.max,10)),"Enter"===e.key&&i!==parseInt(t.dataset.currentpage,10)&&(window.location.href=t.dataset.currenturl+i.toString())})})},i.default(document).on("click",this.identifier.toggle,this.toggleClick),i.default(document).on("click",this.identifier.icons.editMultiple,this.onEditMultiple),i.default(document).on("click",this.identifier.localize,this.disableButton),i.default(document).on("click",this.identifier.searchboxToggle,this.toggleSearchbox),d.ready().then(()=>{o.initialize(".table-fit a[title]"),this.registerPaginationEvents()}),new l("typo3:datahandler:process",this.handleDataHandlerResult.bind(this)).bindTo(document),new l("multiRecordSelection:action:edit",this.onEditMultiple).bindTo(document),new l("multiRecordSelection:action:delete",this.deleteMultiple).bindTo(document),new l("multiRecordSelection:action:copyMarked",t=>{u.submitClipboardFormWithCommand("copyMarked",t.target)}).bindTo(document),new l("multiRecordSelection:action:removeMarked",t=>{u.submitClipboardFormWithCommand("removeMarked",t.target)}).bindTo(document)}static submitClipboardFormWithCommand(t,e){const i=e.closest("form");if(!i)return;const a=i.querySelector('input[name="cmd"]');a&&(a.value=t,i.submit())}static getReturnUrl(t){return""===t&&(t=top.list_frame.document.location.pathname+top.list_frame.document.location.search),encodeURIComponent(t)}handleDataHandlerResult(t){const e=t.detail.payload;e.hasErrors||"datahandler"!==e.component&&"delete"===e.action&&this.deleteRow(e)}deleteMultiple(t){t.preventDefault();const e=t.detail.configuration;r.advanced({title:e.title||"Delete",content:e.content||"Are you sure you want to delete those records?",severity:s.SeverityEnum.warning,buttons:[{text:TYPO3.lang["button.close"]||"Close",active:!0,btnClass:"btn-default",trigger:()=>r.currentModal.trigger("modal-dismiss")},{text:e.ok||TYPO3.lang["button.ok"]||"OK",btnClass:"btn-"+c.getCssClass(s.SeverityEnum.warning),trigger:()=>{r.currentModal.trigger("modal-dismiss"),u.submitClipboardFormWithCommand("delete",t.target)}}]})}}return new u}));
=======
define(["jquery","TYPO3/CMS/Backend/Icons","TYPO3/CMS/Backend/Storage/Persistent","TYPO3/CMS/Core/Event/RegularEvent","TYPO3/CMS/Backend/Tooltip","TYPO3/CMS/Core/DocumentService"],(function(t,e,a,i,n,s){"use strict";class l{constructor(){this.identifier={entity:".t3js-entity",toggle:".t3js-toggle-recordlist",localize:".t3js-action-localize",searchboxToolbar:"#db_list-searchbox-toolbar",searchboxToggle:".t3js-toggle-search-toolbox",searchField:"#search_field",icons:{collapse:"actions-view-list-collapse",expand:"actions-view-list-expand",editMultiple:".t3js-record-edit-multiple"}},this.toggleClick=i=>{i.preventDefault();const n=t(i.currentTarget),s=n.data("table"),l=t(n.data("bs-target")),o="expanded"===l.data("state"),d=n.find(".collapseIcon"),r=o?this.identifier.icons.expand:this.identifier.icons.collapse;e.getIcon(r,e.sizes.small).done(t=>{d.html(t)});let c={};a.isset("moduleData.list")&&(c=a.get("moduleData.list"));const u={};u[s]=o?1:0,t.extend(c,u),a.set("moduleData.list",c).done(()=>{l.data("state",o?"collapsed":"expanded")})},this.onEditMultiple=e=>{let a,i,n,s,l;e.preventDefault(),a=t(e.currentTarget).closest("[data-table]"),0!==a.length&&(s=t(e.currentTarget).data("uri"),i=a.data("table"),n=a.find(this.identifier.entity+'[data-uid][data-table="'+i+'"]').map((e,a)=>t(a).data("uid")).toArray().join(","),l=s.match(/{[^}]+}/g),t.each(l,(e,a)=>{const l=a.substr(1,a.length-2).split(":");let o;switch(l.shift()){case"entityIdentifiers":o=n;break;default:return}t.each(l,(t,e)=>{"editList"===e&&(o=this.editList(i,o))}),s=s.replace(a,o)}),window.location.href=s)},this.disableButton=e=>{t(e.currentTarget).prop("disable",!0).addClass("disabled")},this.toggleSearchbox=()=>{const e=t(this.identifier.searchboxToolbar);e.toggle(),e.is(":visible")&&t(this.identifier.searchField).focus()},this.deleteRow=e=>{const a=t(`table[data-table="${e.table}"]`),i=a.find(`tr[data-uid="${e.uid}"]`),n=a.closest(".panel"),s=n.find(".panel-heading"),l=a.find(`[data-l10nparent="${e.uid}"]`),o=t().add(i).add(l);if(o.fadeTo("slow",.4,()=>{o.slideUp("slow",()=>{o.remove(),0===a.find("tbody tr").length&&n.slideUp("slow")})}),"0"===i.data("l10nparent")||""===i.data("l10nparent")){const t=Number(s.find(".t3js-table-total-items").html());s.find(".t3js-table-total-items").text(t-1)}"pages"===e.table&&top.document.dispatchEvent(new CustomEvent("typo3:pagetree:refresh"))},this.registerPaginationEvents=()=>{document.querySelectorAll(".t3js-recordlist-paging").forEach(t=>{t.addEventListener("keyup",e=>{e.preventDefault();let a=parseInt(t.value,10);a<parseInt(t.min,10)&&(a=parseInt(t.min,10)),a>parseInt(t.max,10)&&(a=parseInt(t.max,10)),"Enter"===e.key&&a!==parseInt(t.dataset.currentpage,10)&&(window.location.href=t.dataset.currenturl+a.toString())})})},t(document).on("click",this.identifier.toggle,this.toggleClick),t(document).on("click",this.identifier.icons.editMultiple,this.onEditMultiple),t(document).on("click",this.identifier.localize,this.disableButton),t(document).on("click",this.identifier.searchboxToggle,this.toggleSearchbox),s.ready().then(()=>{n.initialize(".table-fit a[title]"),this.registerPaginationEvents()}),new i("typo3:datahandler:process",this.handleDataHandlerResult.bind(this)).bindTo(document),new i("recordlist:clipboard:cmd",t=>{t.detail.result&&l.submitClipboardFormWithCommand(t.detail.payload,t.target)}).delegateTo(document,'button[data-event-name="recordlist:clipboard:cmd"]'),new i("click",(t,e)=>{t.preventDefault(),l.submitClipboardFormWithCommand(e.dataset.recordlistClipboardCmd,e)}).delegateTo(document,'[data-recordlist-clipboard-cmd]:not([data-recordlist-clipboard-cmd=""])')}static submitClipboardFormWithCommand(t,e){const a=e.closest("form");if(!a)return;const i=a.querySelector('input[name="cmd"]');i&&(i.value=t,a.submit())}editList(t,e){const a=[];let i=0,n=e.indexOf(",");for(;-1!==n;)this.getCheckboxState(t+"|"+e.substr(i,n-i))&&a.push(e.substr(i,n-i)),i=n+1,n=e.indexOf(",",i);return this.getCheckboxState(t+"|"+e.substr(i))&&a.push(e.substr(i)),a.length>0?a.join(","):e}handleDataHandlerResult(t){const e=t.detail.payload;e.hasErrors||"datahandler"!==e.component&&"delete"===e.action&&this.deleteRow(e)}getCheckboxState(t){const e="CBC["+t+"]",a=document.querySelector('input[name="'+e+'"]');return null!==a&&a.checked}}return new l}));
>>>>>>> 8b6510d860 ([POC][WIP][TASK] TypeScript: Do only use ES6 exports, no pseudo imports)
